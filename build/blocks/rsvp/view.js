import*as t from"@wordpress/interactivity";var e={d:(t,s)=>{for(var n in s)e.o(s,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:s[n]})}};e.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),e.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);const s=(n={getContext:()=>t.getContext,getElement:()=>t.getElement,store:()=>t.store},o={},e.d(o,n),o);var n,o;function r(t){if("object"==typeof GatherPress)return t.split(".").reduce(((t,e)=>t&&t[e]),GatherPress)}function a(t,e){var s;t.posts=null!==(s=t.posts)&&void 0!==s?s:[],e&&!t.posts[e]&&(t.posts[e]={eventResponses:{attending:0,waitingList:0,notAttending:0},currentUser:{status:"no_status",guests:0,anonymous:0},rsvpSelection:"attending"})}function u(t,e,s=null,n=null){["no_status","waiting_list"].includes(e.status)||fetch(r("urls.eventApiUrl")+"/rsvp",{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":r("misc.nonce")},body:JSON.stringify({post_id:t,status:e.status,guests:e.guests,anonymous:e.anonymous})}).then((t=>t.json())).then((e=>{e.success&&(s&&(s.posts[t]={...s.posts[t],eventResponses:{attending:e.responses.attending.count,waitingList:e.responses.waiting_list.count,notAttending:e.responses.not_attending.count},currentUser:{status:e.status,guests:e.guests,anonymous:e.anonymous}}),"function"==typeof n&&n(e))})).catch((()=>{}))}const{state:i,actions:c}=(0,s.store)("gatherpress",{actions:{updateGuestCount(){const t=(0,s.getElement)(),e=(0,s.getContext)().postId||0,n=i.posts[e].currentUser;n.guests=parseInt(t.ref.value,10),a(i,e),u(e,n,i,(()=>{setTimeout((()=>{t.ref.focus()}),1)}))},updateAnonymous(){const t=(0,s.getElement)(),e=(0,s.getContext)().postId||0,n=i.posts[e].currentUser;n.anonymous=t.ref.checked?1:0,a(i,e),u(e,n,i,(()=>{setTimeout((()=>{t.ref.focus()}),1)}))},updateRsvp(t=null){var e;t&&t.preventDefault();const n=(0,s.getElement)(),o=(0,s.getContext)(),r=o?.postId||0,a=null!==(e=n.ref.getAttribute("data-set-status"))&&void 0!==e?e:"",p=i.posts[r].currentUser.status;let l="not_attending";t?["attending","waiting_list","not_attending"].includes(a)?l=a:["not_attending","no_status"].includes(p)&&(l="attending"):l=p,u(r,{status:l,guests:i.posts[r].currentUser.guests,anonymous:i.posts[r].currentUser.anonymous},i,(()=>{const t=n.ref.closest("[data-rsvp-status]"),e=t.getAttribute("data-rsvp-status"),s=t.closest(".wp-block-gatherpress-rsvp");if(["not_attending","no_status"].includes(e)){const t=s.querySelector('[data-rsvp-status="attending"] .gatherpress--update-rsvp');c.openModal(null,t)}setTimeout((()=>{c.closeModal(null,n.ref)}),1)}))}},callbacks:{monitorAnonymousStatus(){const t=(0,s.getElement)(),e=(0,s.getContext)().postId||0;a(i,e),t.ref.checked=i.posts[e].currentUser.anonymous},setGuestCount(){const t=(0,s.getElement)(),e=(0,s.getContext)().postId||0;a(i,e),t.ref.value=i.posts[e].currentUser.guests},renderRsvpBlock(){const t=(0,s.getElement)(),e=(0,s.getContext)().postId||0;a(i,e);const n=JSON.parse(t.ref.getAttribute("data-user-details"));t.ref.removeAttribute("data-user-details"),n&&(i.posts[e]={...i.posts[e],currentUser:{status:n?.status||"no_status",guests:n?.guests||0,anonymous:n?.anonymous||0}}),t.ref.querySelectorAll("[data-rsvp-status]").forEach((t=>{const s=t.parentNode;t.getAttribute("data-rsvp-status")===i.posts[e].currentUser.status?(t.classList.remove("gatherpress--is-not-visible"),s.insertBefore(t,s.firstChild)):t.classList.add("gatherpress--is-not-visible")}))},updateGuestCountDisplay(){const t=(0,s.getContext)(),e=t?.postId||0;a(i,t);const n=parseInt(i.posts[e]?.currentUser?.guests||0,10),o=(0,s.getElement)(),r=o.ref.getAttribute("data-guest-singular"),u=o.ref.getAttribute("data-guest-plural");let c="";0<n&&(c=1===n?r.replace("%d",n):u.replace("%d",n)),o.ref.textContent=c,0<n?o.ref.classList.remove("gatherpress--is-not-visible"):o.ref.classList.add("gatherpress--is-not-visible")}}});