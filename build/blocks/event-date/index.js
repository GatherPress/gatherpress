!function(){"use strict";var e,t={9915:function(e,t,n){var r=window.wp.blocks,a=window.wp.element,s=window.moment,i=n.n(s),o=window.wp.blockEditor,l=window.wp.components;const d=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];for(const[n,r]of Object.entries(e)){let e=n;t&&(e+=t);const a=new CustomEvent(e,{detail:r});dispatchEvent(a)}};var m=JSON.parse('{"$schema":"https://schemas.wp.org/trunk/block.json","apiVersion":2,"name":"gatherpress/event-date","version":"0.1.1","title":"Event Date","category":"gatherpress","icon":"clock","example":{},"description":"The block with event dates.","attributes":{"blockId":{"type":"string"}},"supports":{"html":false},"textdomain":"gatherpress","editorScript":"file:./index.js","render":"file:./render.php","style":"file:./style-index.css"}'),c=window.wp.i18n,u=window.wp.plugins,p=window.wp.editPost;function h(){return"gp_event"===wp.data.select("core/editor").getCurrentPostType()}function v(){wp.data.dispatch("core/editor").editPost({meta:{_non_existing_meta:!0}})}var g=window.wp.data,_=window.wp.apiFetch,f=n.n(_),w=window.React,E=window.wp.date;function P(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;k(e),GatherPress.event_datetime.datetime_start=e,this.setState({dateTime:e}),null!==t&&t({dateTime:e});const n={setDateTimeStart:e};d(n),v()}function S(){return GatherPress.event_datetime.datetime_start=this.state.dateTime,this.state.dateTime}class D extends w.Component{constructor(e){super(e),this.state={dateTime:GatherPress.event_datetime.datetime_start}}componentDidMount(){this.updateDateTimeStart=P,this.getDateTimeStart=S,P=P.bind(this),S=S.bind(this)}componentWillUnmount(){P=this.updateDateTimeStart,S=this.getDateTimeStart}render(){const e=(0,E.__experimentalGetSettings)();return(0,E.dateI18n)(`${e.formats.date} ${e.formats.time}`,this.state.dateTime)}}function T(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;G(e),GatherPress.event_datetime.datetime_end=e,this.setState({dateTime:e}),null!==t&&t({dateTime:e});const n={setDateTimeEnd:e};d(n),v()}function b(){return GatherPress.event_datetime.datetime_end=this.state.dateTime,x(),this.state.dateTime}function x(){const e="gp_event_past",t=wp.data.dispatch("core/notices"),n=i()().valueOf()>i()(GatherPress.event_datetime.datetime_end).valueOf();t.removeNotice(e),n&&t.createNotice("warning",(0,c.__)("This event has already past.","gatherpress"),{id:e,isDismissible:!0})}class O extends w.Component{constructor(e){super(e),this.state={dateTime:GatherPress.event_datetime.datetime_end}}componentDidMount(){this.updateDateTimeEnd=T,this.getDateTimeEnd=b,T=T.bind(this),b=b.bind(this),x()}componentWillUnmount(){T=this.updateDateTimeEnd,b=this.getDateTimeEnd}componentDidUpdate(){x()}render(){const e=(0,E.__experimentalGetSettings)();return(0,E.dateI18n)(`${e.formats.date} ${e.formats.time}`,this.state.dateTime)}}const y="YYYY-MM-DDTHH:mm:ss";function k(e){const t=i()(GatherPress.event_datetime.datetime_end).valueOf(),n=i()(e).valueOf();n>=t&&T(i()(n).add(2,"hours").format(y)),x()}function G(e){const t=i()(GatherPress.event_datetime.datetime_start).valueOf(),n=i()(e).valueOf();n<=t&&P(i()(n).subtract(2,"hours").format(y)),x()}var Y=window.wp.compose;const C=(0,Y.withState)()((e=>{let{setState:t}=e;const n=(0,E.__experimentalGetSettings)(),r=/a(?!\\)/i.test(n.formats.time.toLowerCase().replace(/\\\\/g,"").split("").reverse().join(""));return(0,a.createElement)(l.DateTimePicker,{currentDate:S(),onChange:e=>P(e,t),is12Hour:r})})),M=(0,Y.withState)()((e=>{let{setState:t}=e;const n=(0,E.__experimentalGetSettings)(),r=/a(?!\\)/i.test(n.formats.time.toLowerCase().replace(/\\\\/g,"").split("").reverse().join(""));return(0,a.createElement)(l.DateTimePicker,{currentDate:b(),onChange:e=>T(e,t),is12Hour:r})})),j=i()().add(2,"weeks").set("hour",18).set("minute",0).format(y);let F=GatherPress.event_datetime.datetime_start,I=GatherPress.event_datetime.datetime_end;(0,g.subscribe)((function(){const e=wp.data.select("core/editor").isSavingPost(),t=wp.data.select("core/editor").isAutosavingPost();h()&&e&&!t&&f()({path:"/gatherpress/v1/event/datetime/",method:"POST",data:{post_id:GatherPress.post_id,datetime_start:i()(GatherPress.event_datetime.datetime_start).format("YYYY-MM-DD HH:mm:ss"),datetime_end:i()(GatherPress.event_datetime.datetime_end).format("YYYY-MM-DD HH:mm:ss"),_wpnonce:GatherPress.nonce}}).then((()=>{}))})),F=""!==F?i()(F).format(y):j,I=""!==I?i()(I).format(y):i()(j).add(2,"hours").format(y),GatherPress.event_datetime.datetime_start=F,GatherPress.event_datetime.datetime_end=I;const H=()=>(0,a.createElement)("section",null,(0,a.createElement)("h3",null,(0,c.__)("Date & time","gatherpress")),(0,a.createElement)(l.PanelRow,null,(0,a.createElement)("span",null,(0,c.__)("Start","gatherpress")),(0,a.createElement)(l.Dropdown,{position:"bottom left",renderToggle:e=>{let{isOpen:t,onToggle:n}=e;return(0,a.createElement)(l.Button,{onClick:n,"aria-expanded":t,isLink:!0},(0,a.createElement)(D,null))},renderContent:()=>(0,a.createElement)(C,null)})),(0,a.createElement)(l.PanelRow,null,(0,a.createElement)("span",null,(0,c.__)("End","gatherpress")),(0,a.createElement)(l.Dropdown,{position:"bottom left",renderToggle:e=>{let{isOpen:t,onToggle:n}=e;return(0,a.createElement)(l.Button,{onClick:n,"aria-expanded":t,isLink:!0},(0,a.createElement)(O,null))},renderContent:()=>(0,a.createElement)(M,null)})));var L=e=>{const{venue:t,setVenue:n}=e,r=(0,g.useDispatch)("core/editor").editPost,{unlockPostSaving:s}=(0,g.useDispatch)("core/editor"),i=(0,g.useSelect)((e=>e("core/editor").getEditedPostAttribute("_gp_venue"))),o=(0,g.useSelect)((e=>e("core").getEntityRecord("taxonomy","_gp_venue",i))),m=null==o?void 0:o.slug.replace("_venue_",""),u=i+":"+m;(0,a.useEffect)((()=>{var e;n(null!==(e=String(u))&&void 0!==e?e:""),d({setVenueId:m})}));let p=(0,g.useSelect)((e=>e("core").getEntityRecords("taxonomy","_gp_venue",{per_page:-1,context:"view"})),[t]);return p?(p=p.map((e=>({label:e.name,value:e.id+":"+e.slug.replace("_venue_","")}))),p.unshift({value:":",label:(0,c.__)("Choose a venue","gatherpress")})):p=[],(0,a.createElement)(l.PanelRow,null,(0,a.createElement)(l.Flex,null,(0,a.createElement)(l.FlexItem,null,(0,c.__)("Venue","gatherpress")),(0,a.createElement)(l.FlexItem,null,(0,a.createElement)(l.SelectControl,{label:(0,c.__)("Venue","gatherpress"),hideLabelFromVision:"true",value:t,onChange:e=>{(e=>{n(e);const t=""!==(e=e.split(":"))[0]?[e[0]]:[];r({_gp_venue:t}),d({setVenueId:e[1]}),s()})(e)},options:p,style:{width:"11rem"}}))))};(0,u.registerPlugin)("gatherpress-event-settings",{render:()=>{const[e,t]=(0,a.useState)("");return h()&&(0,a.createElement)(p.PluginDocumentSettingPanel,{name:"gatherpress-event-settings",title:(0,c.__)("Event settings","gatherpress"),initialOpen:!0,className:"gatherpress-event-settings"},(0,a.createElement)(H,null),(0,a.createElement)("hr",null),(0,a.createElement)(L,{venue:e,setVenue:t}))},icon:""});var N=window.ReactDOM,R=window.lodash,V=window.wp.coreData,A=e=>{var t,n;const{name:r,option:s,value:i}=e.attrs,[o,d]=(0,a.useState)(null!==(t=JSON.parse(i))&&void 0!==t?t:"[]"),{usersList:m}=(0,g.useSelect)((e=>{const{getEntityRecords:t}=e(V.store);return{usersList:t("root","user",{per_page:-1,context:"view"})}}),[o]),u=null!==(n=null==m?void 0:m.reduce(((e,t)=>({...e,[t.name]:t})),{}))&&void 0!==n?n:{};return(0,a.createElement)(a.Fragment,null,(0,a.createElement)(l.FormTokenField,{key:s,label:(0,c.__)("Select Users","gatherpress"),name:r,value:o&&o.map((e=>({id:e.id,slug:e.slug,value:e.name||e.value}))),suggestions:Object.keys(u),onChange:e=>{if(e.some((e=>"string"==typeof e&&!u[e])))return;const t=e.map((e=>"string"==typeof e?u[e]:e));if((0,R.includes)(t,null))return!1;d(t)},maxSuggestions:20}),(0,a.createElement)("input",{type:"hidden",id:s,name:r,value:o&&JSON.stringify(o.map((e=>({id:e.id,slug:e.slug,value:e.name||e.value}))))}))};const $=document.querySelectorAll('[data-gp_component_name="user-select"]');for(let e=0;e<$.length;e++){const t=JSON.parse($[e].dataset.gp_component_attrs);(0,N.render)((0,a.createElement)(A,{attrs:t}),$[e])}(0,r.registerBlockType)(m,{edit:()=>{const e=(0,o.useBlockProps)(),[t,n]=(0,a.useState)(GatherPress.event_datetime.datetime_start),[r,s]=(0,a.useState)(GatherPress.event_datetime.datetime_end);return function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];for(const[n,r]of Object.entries(e)){let e=n;t&&(e+=t),addEventListener(e,(e=>{r(e.detail)}),!1)}}({setDateTimeEnd:s,setDateTimeStart:n}),(0,a.createElement)("div",e,(0,a.createElement)(l.Flex,{justify:"normal",align:"flex-start",gap:"4"},(0,a.createElement)(l.FlexItem,{display:"flex",className:"gatherpress-event-date__icon"},(0,a.createElement)(l.Icon,{icon:"clock"})),(0,a.createElement)(l.FlexItem,null,((e,t)=>{const n="dddd, MMMM D, YYYY",r=GatherPress.event_datetime.timezone;let a=n+" h:mm A z";return i()(e).format(n)===i()(t).format(n)&&(a="h:mm A z"),i()(e).format("dddd, MMMM D, YYYY h:mm A")+" to "+i().tz(t,r).format(a)})(t,r))))},save:()=>null})}},n={};function r(e){var a=n[e];if(void 0!==a)return a.exports;var s=n[e]={exports:{}};return t[e](s,s.exports,r),s.exports}r.m=t,e=[],r.O=function(t,n,a,s){if(!n){var i=1/0;for(m=0;m<e.length;m++){n=e[m][0],a=e[m][1],s=e[m][2];for(var o=!0,l=0;l<n.length;l++)(!1&s||i>=s)&&Object.keys(r.O).every((function(e){return r.O[e](n[l])}))?n.splice(l--,1):(o=!1,s<i&&(i=s));if(o){e.splice(m--,1);var d=a();void 0!==d&&(t=d)}}return t}s=s||0;for(var m=e.length;m>0&&e[m-1][2]>s;m--)e[m]=e[m-1];e[m]=[n,a,s]},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,{a:t}),t},r.d=function(e,t){for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},function(){var e={591:0,42:0};r.O.j=function(t){return 0===e[t]};var t=function(t,n){var a,s,i=n[0],o=n[1],l=n[2],d=0;if(i.some((function(t){return 0!==e[t]}))){for(a in o)r.o(o,a)&&(r.m[a]=o[a]);if(l)var m=l(r)}for(t&&t(n);d<i.length;d++)s=i[d],r.o(e,s)&&e[s]&&e[s][0](),e[s]=0;return r.O(m)},n=self.webpackChunkgatherpress=self.webpackChunkgatherpress||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))}();var a=r.O(void 0,[42],(function(){return r(9915)}));a=r.O(a)}();