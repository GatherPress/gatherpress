(()=>{"use strict";var e={n:t=>{var r=t&&t.__esModule?()=>t.default:()=>t;return e.d(r,{a:r}),r},d:(t,r)=>{for(var o in r)e.o(r,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:r[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.wp.domReady;var r=e.n(t);const o=window.wp.data,s=window.moment;var n=e.n(s);const a=window.wp.i18n,i=window.wp.element;function d(e){if("object"==typeof GatherPress)return e.split(".").reduce(((e,t)=>e&&e[t]),GatherPress)}function c(e,t){if("object"!=typeof GatherPress)return;const r=e.split("."),o=r.pop();r.reduce(((e,t)=>{var r;return null!==(r=e[t])&&void 0!==r?r:e[t]={}}),GatherPress)[o]=t}window.wp.date;const l=window.ReactJSXRuntime,u="YYYY-MM-DD HH:mm:ss",p=n().tz(h()).add(1,"day").set("hour",18).set("minute",0).set("second",0).format(u),m=n().tz(p,h()).add(2,"hours").format(u),g=[{label:(0,a.__)("1 hour","gatherpress"),value:1},{label:(0,a.__)("1.5 hours","gatherpress"),value:1.5},{label:(0,a.__)("2 hours","gatherpress"),value:2},{label:(0,a.__)("3 hours","gatherpress"),value:3},{label:(0,a.__)("Set an end timeâ€¦","gatherpress"),value:!1}];function h(e=d("eventDetails.dateTime.timezone")){return n().tz.zone(e)?e:(0,a.__)("GMT","gatherpress")}function _(){const e=n().tz(d("eventDetails.dateTime.datetime_end"),h());return"gatherpress_event"===(0,o.select)("core/editor")?.getCurrentPostType()&&n().tz(h()).valueOf()>e.valueOf()}let T=!1;function v(){const e="gatherpress_event_communication",t=(0,o.dispatch)("core/notices"),r=(0,o.select)("core/editor").isSavingPost(),s=(0,o.select)("core/editor").isAutosavingPost();"publish"!==(0,o.select)("core/editor").getEditedPostAttribute("status")||"gatherpress_event"!==(0,o.select)("core/editor")?.getCurrentPostType()||!r||s||_()||T||(T=!0,t.removeNotice(e),t.createNotice("success",(0,a.__)("Send an event update to members via email?","gatherpress"),{id:e,isDismissible:!0,actions:[{onClick:()=>{((e,t="")=>{for(const[r,o]of Object.entries(e)){let e=r;t&&(e+="_"+String(t));const s=new CustomEvent(e,{detail:o});dispatchEvent(s)}})({setOpen:!0})},label:(0,a.__)("Compose Message","gatherpress")}]})),r||(T=!1)}const b=window.wp.blocks,E=window.wp.compose,k=window.wp.blockEditor,y=window.wp.components,w=window.wp.hooks,f={dateTimeStart:d("eventDetails.dateTime.datetime_start")?d("eventDetails.dateTime.datetime_start"):p,dateTimeEnd:d("eventDetails.dateTime.datetime_end")?d("eventDetails.dateTime.datetime_end"):m,duration:g.find((e=>{return t=e.value,n().tz(function(){let e=d("eventDetails.dateTime.datetime_start");return e=""!==e?n().tz(e,h()).format(u):p,c("eventDetails.dateTime.datetime_start",e),e}(),h()).add(t,"hours").format(u)===function(){let e=d("eventDetails.dateTime.datetime_end");return e=""!==e?n().tz(e,h()).format(u):m,c("eventDetails.dateTime.datetime_end",e),e}();var t}))?.value||!1,timezone:d("eventDetails.dateTime.timezone")},D={setDateTimeStart:e=>(c("eventDetails.dateTime.datetime_start",e),{type:"SET_DATETIME_START",dateTimeStart:e}),setDateTimeEnd:e=>(c("eventDetails.dateTime.datetime_end",e),{type:"SET_DATETIME_END",dateTimeEnd:e}),setDuration:e=>({type:"SET_DURATION",duration:e}),setTimezone:e=>(c("eventDetails.dateTime.timezone",e),{type:"SET_TIMEZONE",timezone:e})},S=(0,o.createReduxStore)("gatherpress/datetime",{reducer:(e=f,t)=>{switch(t.type){case"SET_DATETIME_START":return{...e,dateTimeStart:t.dateTimeStart};case"SET_DATETIME_END":return{...e,dateTimeEnd:t.dateTimeEnd};case"SET_DURATION":return{...e,duration:t.duration};case"SET_TIMEZONE":return{...e,timezone:t.timezone};default:return e}},actions:D,selectors:{getDateTimeStart:e=>e.dateTimeStart,getDateTimeEnd:e=>e.dateTimeEnd,getDuration:e=>e.duration,getTimezone:e=>e.timezone}});(0,o.register)(S);const A={latitude:0,longitude:0,mapCustomLatLong:!1},I=(0,o.createReduxStore)("gatherpress/venue",{reducer:(e=A,t)=>{switch(t.type){case"UPDATE_VENUE_LATITUDE":return{...e,latitude:t.latitude};case"UPDATE_VENUE_LONGITUDE":return{...e,longitude:t.longitude};case"UPDATE_MAP_CUSTOM_LAT_LONG":return{...e,mapCustomLatLong:t.mapCustomLatLong};default:return e}},actions:{updateVenueLatitude:e=>({type:"UPDATE_VENUE_LATITUDE",latitude:e}),updateVenueLongitude:e=>({type:"UPDATE_VENUE_LONGITUDE",longitude:e}),updateMapCustomLatLong:e=>({type:"UPDATE_MAP_CUSTOM_LAT_LONG",mapCustomLatLong:e})},selectors:{getVenueLatitude:e=>e.latitude,getVenueLongitude:e=>e.longitude,getMapCustomLatLong:e=>e.mapCustomLatLong}});(0,o.register)(I),r()((()=>{const e=(0,o.select)("core/edit-post"),t=(0,o.dispatch)("core/edit-post");e&&t&&(e.isEditorSidebarOpened("edit-post/document")||t.openGeneralSidebar("edit-post/document"),(0,o.subscribe)(v),function(){const e="gatherpress_event_past",t=(0,o.dispatch)("core/notices");t.removeNotice(e),_()&&t.createNotice("warning",(0,a.__)("This event has already passed.","gatherpress"),{id:e,isDismissible:!1})}())})),r()((()=>{Object.keys(d("misc.unregisterBlocks")).forEach((e=>{const t=d("misc.unregisterBlocks")[e];t&&void 0!==(0,b.getBlockType)(t)&&(0,b.unregisterBlockType)(t)}))})),(0,w.addFilter)("blocks.registerBlockType","gatherpress/add-post-id-override-support",(function(e){return e.supports?.gatherpress?.postIdOverride&&(e.attributes={...e.attributes,postId:{type:"number"}}),e}));const L=(0,E.createHigherOrderComponent)((e=>t=>{const{name:r,clientId:s}=t;if(!r.startsWith("gatherpress/")||!(0,b.getBlockType)(r)?.supports?.gatherpress?.postIdOverride)return(0,l.jsx)(e,{...t});const n=(0,o.useSelect)((e=>{var t;const{getBlockAttributes:r}=e("core/block-editor");return null!==(t=r(s)?.postId)&&void 0!==t?t:""}),[s]),{updateBlockAttributes:i}=(0,o.useDispatch)("core/block-editor");return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(e,{...t}),(0,l.jsx)(k.InspectorAdvancedControls,{children:(0,l.jsx)(y.__experimentalNumberControl,{label:(0,a.__)("Post ID Override","gatherpress"),value:n,onChange:e=>{i(s,{postId:parseInt(e,10)||0})},help:(0,a.__)("Specify the post ID of an event to replace the default post ID used by this block.","gatherpress")})})]})}),"withPostIdOverride");(0,w.addFilter)("editor.BlockEdit","gatherpress/with-post-id-override",L);const C=(0,E.createHigherOrderComponent)((e=>t=>{const{name:r,clientId:s}=t;if(!r.startsWith("gatherpress/")||!(0,b.getBlockType)(r)?.supports?.gatherpress?.blockGuard)return(0,l.jsx)(e,{...t});const[n,d]=(0,i.useState)(!0),c=(0,k.useBlockProps)();return(0,i.useEffect)((()=>{if(!s)return;const e=()=>{const e=document.querySelector(`[data-block="${s}"]`);if(!e)return;const t=e.querySelector(".block-editor-inner-blocks");if(!t)return;"relative"!==getComputedStyle(t).position&&(t.style.position="relative");let r=t.querySelector(".gp-block-guard");if(n){if(!r){r=document.createElement("div"),r.className="gp-block-guard",r.style.position="absolute",r.style.top="0",r.style.right="0",r.style.bottom="0",r.style.left="0",r.style.zIndex="99",r.style.cursor="pointer",r.style.background="transparent",r.addEventListener("mousedown",(e=>{e.preventDefault(),e.stopPropagation(),(0,o.dispatch)("core/block-editor").selectBlock(s)})),r.addEventListener("click",(e=>{e.preventDefault(),e.stopPropagation()})),r.setAttribute("tabindex","0");const a=t=>{if((n&&document.activeElement===e||e.contains(document.activeElement))&&["ArrowDown","ArrowUp","ArrowLeft","ArrowRight"].includes(t.key)){t.preventDefault(),t.stopPropagation();const e=(0,o.select)("core/block-editor"),r=e.getBlocks();let n=s,a=e.getBlock(s);for(;e.getBlockRootClientId(n);)n=e.getBlockRootClientId(n),a=e.getBlock(n);const i=r.findIndex((e=>e.clientId===n));"ArrowDown"===t.key||"ArrowRight"===t.key?i<r.length-1&&(0,o.dispatch)("core/block-editor").selectBlock(r[i+1].clientId):"ArrowUp"!==t.key&&"ArrowLeft"!==t.key||i>0&&(0,o.dispatch)("core/block-editor").selectBlock(r[i-1].clientId)}};document.addEventListener("keydown",a,!0),e._blockGuardKeyHandler=a,t.appendChild(r)}}else r&&r.remove()};e();const t=new MutationObserver((()=>{e()}));return t.observe(document.body,{childList:!0,subtree:!0}),()=>{t.disconnect(),document.body._blockGuardKeyHandler&&(document.removeEventListener("keydown",document.body._blockGuardKeyHandler,!0),delete document.body._blockGuardKeyHandler)}}),[s,n]),(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("div",{...c,children:(0,l.jsx)(e,{...t})}),(0,l.jsx)(k.InspectorControls,{children:(0,l.jsx)(y.PanelBody,{children:(0,l.jsx)(y.ToggleControl,{label:(0,a.__)("Block Guard","gatherpress"),checked:n,onChange:d,help:n?(0,a.__)("Block protection is enabled. Click to focus on parent block.","gatherpress"):(0,a.__)("Block protection is disabled. Inner blocks can be freely edited.","gatherpress")})})})]})}),"withBlockGuard");(0,w.addFilter)("editor.BlockEdit","gatherpress/with-block-guard",C)})();