(()=>{"use strict";var e={n:t=>{var r=t&&t.__esModule?()=>t.default:()=>t;return e.d(r,{a:r}),r},d:(t,r)=>{for(var o in r)e.o(r,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:r[o]})}};e.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),e.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);const t=window.wp.domReady;var r=e.n(t);const o=window.wp.data,n=window.wp.blocks;function s(e){if("object"==typeof GatherPress)return e.split(".").reduce(((e,t)=>e&&e[t]),GatherPress)}function a(e,t){if("object"!=typeof GatherPress)return;const r=e.split("."),o=r.pop();r.reduce(((e,t)=>{var r;return null!==(r=e[t])&&void 0!==r?r:e[t]={}}),GatherPress)[o]=t}const i=window.moment;var d=e.n(i);const l=window.wp.i18n,c=window.wp.element,u=window.wp.hooks;window.wp.date;const p=window.ReactJSXRuntime,m="YYYY-MM-DD HH:mm:ss",g=d().tz(T()).add(1,"day").set("hour",18).set("minute",0).set("second",0).format(m),b=d().tz(g,T()).add(2,"hours").format(m);function h(){return function(){const e=[{label:(0,l.__)("1 hour","gatherpress"),value:1},{label:(0,l.__)("1.5 hours","gatherpress"),value:1.5},{label:(0,l.__)("2 hours","gatherpress"),value:2},{label:(0,l.__)("3 hours","gatherpress"),value:3},{label:(0,l.__)("Set an end timeâ€¦","gatherpress"),value:!1}];return(0,u.applyFilters)("gatherpress.durationOptions",e)}().find((e=>{return t=e.value,d().tz(function(){let e=s("eventDetails.dateTime.datetime_start");return e=""!==e?d().tz(e,T()).format(m):g,a("eventDetails.dateTime.datetime_start",e),e}(),T()).add(t,"hours").format(m)===function(){let e=s("eventDetails.dateTime.datetime_end");return e=""!==e?d().tz(e,T()).format(m):b,a("eventDetails.dateTime.datetime_end",e),e}();var t}))?.value||!1}function T(e=s("eventDetails.dateTime.timezone")){return d().tz.zone(e)?e:(0,l.__)("GMT","gatherpress")}function v(){const e=d().tz(s("eventDetails.dateTime.datetime_end"),T());return"gatherpress_event"===(0,o.select)("core/editor")?.getCurrentPostType()&&d().tz(T()).valueOf()>e.valueOf()}let _=!1;function y(){const e="gatherpress_event_communication",t=(0,o.dispatch)("core/notices"),r=(0,o.select)("core/editor").isSavingPost(),n=(0,o.select)("core/editor").isAutosavingPost();"publish"!==(0,o.select)("core/editor").getEditedPostAttribute("status")||"gatherpress_event"!==(0,o.select)("core/editor")?.getCurrentPostType()||!r||n||v()||_||(_=!0,t.removeNotice(e),t.createNotice("success",(0,l.__)("Send an event update to members via email?","gatherpress"),{id:e,isDismissible:!0,actions:[{onClick:()=>{((e,t="")=>{for(const[r,o]of Object.entries(e)){let e=r;t&&(e+="_"+String(t));const n=new CustomEvent(e,{detail:o});dispatchEvent(n)}})({setOpen:!0})},label:(0,l.__)("Compose Message","gatherpress")}]})),r||(_=!1)}const E={dateTimeStart:s("eventDetails.dateTime.datetime_start")?s("eventDetails.dateTime.datetime_start"):g,dateTimeEnd:s("eventDetails.dateTime.datetime_end")?s("eventDetails.dateTime.datetime_end"):b,duration:null,timezone:s("eventDetails.dateTime.timezone")},f={setDateTimeStart:e=>(a("eventDetails.dateTime.datetime_start",e),{type:"SET_DATETIME_START",dateTimeStart:e}),setDateTimeEnd:e=>(a("eventDetails.dateTime.datetime_end",e),{type:"SET_DATETIME_END",dateTimeEnd:e}),setDuration:e=>({type:"SET_DURATION",duration:e}),setTimezone:e=>(a("eventDetails.dateTime.timezone",e),{type:"SET_TIMEZONE",timezone:e})},k=(0,o.createReduxStore)("gatherpress/datetime",{reducer:(e=E,t)=>{switch(t.type){case"SET_DATETIME_START":return{...e,dateTimeStart:t.dateTimeStart};case"SET_DATETIME_END":return{...e,dateTimeEnd:t.dateTimeEnd};case"SET_DURATION":return{...e,duration:t.duration};case"SET_TIMEZONE":return{...e,timezone:t.timezone};default:return e}},actions:f,selectors:{getDateTimeStart:e=>e.dateTimeStart,getDateTimeEnd:e=>e.dateTimeEnd,getDuration:e=>!1!==e.duration&&h(),getTimezone:e=>e.timezone}});(0,o.register)(k);const w={latitude:0,longitude:0,mapCustomLatLong:!1},D=(0,o.createReduxStore)("gatherpress/venue",{reducer:(e=w,t)=>{switch(t.type){case"UPDATE_VENUE_LATITUDE":return{...e,latitude:t.latitude};case"UPDATE_VENUE_LONGITUDE":return{...e,longitude:t.longitude};case"UPDATE_MAP_CUSTOM_LAT_LONG":return{...e,mapCustomLatLong:t.mapCustomLatLong};default:return e}},actions:{updateVenueLatitude:e=>({type:"UPDATE_VENUE_LATITUDE",latitude:e}),updateVenueLongitude:e=>({type:"UPDATE_VENUE_LONGITUDE",longitude:e}),updateMapCustomLatLong:e=>({type:"UPDATE_MAP_CUSTOM_LAT_LONG",mapCustomLatLong:e})},selectors:{getVenueLatitude:e=>e.latitude,getVenueLongitude:e=>e.longitude,getMapCustomLatLong:e=>e.mapCustomLatLong}});(0,o.register)(D);const S=window.wp.compose,I=window.wp.blockEditor,L=window.wp.components;(0,u.addFilter)("blocks.registerBlockType","gatherpress/add-post-id-override-support",(function(e){return e.supports?.gatherpress?.postIdOverride&&(e.attributes={...e.attributes,postId:{type:"number"}}),e}));const x=(0,S.createHigherOrderComponent)((e=>t=>{const{name:r,clientId:s}=t;if(!r.startsWith("gatherpress/")||!(0,n.getBlockType)(r)?.supports?.gatherpress?.postIdOverride)return(0,p.jsx)(e,{...t});const a=(0,o.useSelect)((e=>{var t;const{getBlockAttributes:r}=e("core/block-editor");return null!==(t=r(s)?.postId)&&void 0!==t?t:""}),[s]),{updateBlockAttributes:i}=(0,o.useDispatch)("core/block-editor");return(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(e,{...t}),(0,p.jsx)(I.InspectorAdvancedControls,{children:(0,p.jsx)(L.__experimentalNumberControl,{label:(0,l.__)("Post ID Override","gatherpress"),value:a,onChange:e=>{i(s,{postId:parseInt(e,10)||0})},help:(0,l.__)("Specify the post ID of an event to replace the default post ID used by this block.","gatherpress")})})]})}),"withPostIdOverride");(0,u.addFilter)("editor.BlockEdit","gatherpress/with-post-id-override",x);const A=(0,S.createHigherOrderComponent)((t=>r=>{const{name:s,clientId:a}=r;if(!s.startsWith("gatherpress/")||!(0,n.getBlockType)(s)?.supports?.gatherpress?.blockGuard)return(0,p.jsx)(t,{...r});const[i,d]=(0,c.useState)(!0);return(0,c.useEffect)((()=>{if(!a)return;const t=()=>{const t=e.g.document.getElementById(`block-${a}`);if(!t)return;const r=t.querySelector(".block-editor-inner-blocks");if(!r)return;r.querySelectorAll('\n\t\t\t\t\ta[href],\n\t\t\t\t\tbutton,\n\t\t\t\t\tinput,\n\t\t\t\t\ttextarea,\n\t\t\t\t\tselect,\n\t\t\t\t\tdetails,\n\t\t\t\t\tiframe,\n\t\t\t\t\t[tabindex],\n\t\t\t\t\t[contentEditable="true"],\n\t\t\t\t\taudio[controls],\n\t\t\t\t\tvideo[controls],\n\t\t\t\t\t[role="button"],\n\t\t\t\t\t[role="link"],\n\t\t\t\t\t[role="checkbox"],\n\t\t\t\t\t[role="radio"],\n\t\t\t\t\t[role="combobox"],\n\t\t\t\t\t[role="menuitem"],\n\t\t\t\t\t[role="textbox"],\n\t\t\t\t\t[role="tab"]\n\t\t\t\t').forEach((e=>{i?(e.dataset.originalTabIndex||(e.dataset.originalTabIndex=e.getAttribute("tabindex")),e.setAttribute("tabindex","-1")):e.dataset.originalTabIndex&&(e.setAttribute("tabindex",e.dataset.originalTabIndex),delete e.dataset.originalTabIndex)}));const n=r.querySelector(".block-list-appender");n&&(n.style.display=i?"none":"");let s=r.querySelector(".gatherpress-block-guard-overlay");s||(s=e.g.document.createElement("div"),s.className="gatherpress-block-guard-overlay",s.style.position="absolute",s.style.top="0",s.style.left="0",s.style.width="100%",s.style.height="100%",s.style.background="transparent",s.style.zIndex="60",s.onclick=e=>{e.stopPropagation(),(0,o.dispatch)("core/block-editor").selectBlock(a)},r.style.position="relative",r.appendChild(s)),s.style.display=i?"block":"none"};t();const r=new MutationObserver(t);return r.observe(e.g.document.body,{childList:!0,subtree:!0}),()=>{r.disconnect();const t=e.g.document.getElementById(`block-${a}`),o=t?.querySelector(".block-editor-inner-blocks"),n=o?.querySelector(".gatherpress-block-guard-overlay");n&&n.parentNode&&n.parentNode.removeChild(n)}}),[a,i]),(0,c.useEffect)((()=>{if(!a)return;let t=null;const r=()=>{const r=e.g.document.querySelector(`.block-editor-list-view-leaf[data-block="${a}"]`);if(!r)return;const o=r.querySelector(".block-editor-list-view__expander");if(o&&o.querySelector("svg"))if(i){"true"===r.getAttribute("data-expanded")&&o.click(),o.style.pointerEvents="none",o.style.opacity="0.3";const n=o.closest(".block-editor-list-view-block-select-button");n&&(n.setAttribute("aria-expanded","false"),n.style.pointerEvents="none",setTimeout((()=>{n.style.pointerEvents="auto",n.classList.add("gatherpress-block-guard-enabled"),o.style.pointerEvents="none"}),0)),t||(t=e=>{const t=e.target.closest(`[data-block="${a}"]`);if(!t)return;const r=t.getBoundingClientRect(),o=e.clientY-r.top,n=Math.min(15,.15*r.height);o<n||o>r.height-n||e.stopPropagation()},e.g.document.addEventListener("dragover",t,!0))}else{o.style.pointerEvents="",o.style.opacity="";const r=o.closest(".block-editor-list-view-block-select-button");r&&(r.style.pointerEvents="",r.classList.remove("gatherpress-block-guard-enabled")),t&&(e.g.document.removeEventListener("dragover",t,!0),t=null)}};setTimeout(r,100);const o=new MutationObserver((()=>setTimeout(r,50)));return o.observe(e.g.document.body,{childList:!0,subtree:!0}),()=>{o.disconnect(),t&&e.g.document.removeEventListener("dragover",t,!0)}}),[a,i]),(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(t,{...r}),(0,p.jsx)(I.InspectorControls,{children:(0,p.jsx)(L.PanelBody,{children:(0,p.jsx)(L.ToggleControl,{label:(0,l.__)("Block Guard","gatherpress"),checked:i,onChange:d,help:i?(0,l.__)("Toggle to unprotect and update the block.","gatherpress"):(0,l.__)("Block protection is disabled. Inner blocks can be freely edited.","gatherpress")})})})]})}),"withBlockGuard");(0,u.addFilter)("editor.BlockEdit","gatherpress/with-block-guard",A),r()((()=>{const e=(0,o.select)("core/edit-post"),t=(0,o.dispatch)("core/edit-post");e&&t&&(e.isEditorSidebarOpened("edit-post/document")||t.openGeneralSidebar("edit-post/document"),(0,o.subscribe)(y),function(){const e="gatherpress_event_past",t=(0,o.dispatch)("core/notices");t.removeNotice(e),v()&&t.createNotice("warning",(0,l.__)("This event has already passed.","gatherpress"),{id:e,isDismissible:!1})}())})),r()((()=>{Object.keys(s("misc.unregisterBlocks")).forEach((e=>{const t=s("misc.unregisterBlocks")[e];t&&void 0!==(0,n.getBlockType)(t)&&(0,n.unregisterBlockType)(t)}))}))})();