(()=>{"use strict";var e={n:t=>{var n=t&&t.__esModule?()=>t.default:()=>t;return e.d(n,{a:n}),n},d:(t,n)=>{for(var r in n)e.o(n,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:n[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.wp.element,n=window.wp.i18n,r=window.wp.data,a=window.wp.components,s=window.wp.plugins,i=window.wp.editPost,o=window.moment;var l=e.n(o);const m=window.wp.apiFetch;var c=e.n(m);function d(){(0,r.dispatch)("core/editor").editPost({meta:{_non_existing_meta:!0}})}const u="YYYY-MM-DDTHH:mm:ss",p="YYYY-MM-DD HH:mm:ss",_="MMMM D, YYYY h:mm a",g=(()=>{const e=GatherPress.event_datetime.timezone;return l().tz.zone(e)?e:"UTC"})(),v=((()=>{if("UTC"!==g)return"";const e=/(\+|-)([0-9]{1,2}):([0-9]{2})/.exec(GatherPress.event_datetime.timezone);e&&4===e.length&&String(e[1]+(parseInt(e[2],10)+parseInt(e[3],10)/60))})(),l().tz(g).add(1,"day").set("hour",18).set("minute",0).set("second",0).format(u)),h=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;f(e),GatherPress.event_datetime.datetime_start=e,"function"==typeof t&&t(e),d()},E=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;w(e),GatherPress.event_datetime.datetime_end=e,null!==t&&t(e),d()};function f(e){const t=l().tz(GatherPress.event_datetime.datetime_end,g).valueOf(),n=l().tz(e,g).valueOf();if(n>=t){const e=l().tz(n,g).add(2,"hours").format(u);E(e)}}function w(e){const t=l().tz(GatherPress.event_datetime.datetime_start,g).valueOf(),n=l().tz(e,g).valueOf();if(n<=t){const e=l().tz(n,g).subtract(2,"hours").format(u);h(e)}}function P(){return"gp_event"===(0,r.select)("core/editor").getCurrentPostType()}function T(){const e="gp_event_past",t=(0,r.dispatch)("core/notices");t.removeNotice(e),function(){const e=l()(GatherPress.event_datetime.datetime_end);return l().tz(g).valueOf()>e.tz(g).valueOf()}()&&t.createNotice("warning",(0,n.__)("This event has already past.","gatherpress"),{id:e,isDismissible:!1})}const S=window.wp.date,D=e=>{const{dateTimeStart:t}=e;return l().tz(t,g).format(_)},z=e=>{const{dateTimeEnd:t}=e;return l().tz(t,g).format(_)},x=e=>{const{dateTimeStart:n,setDateTimeStart:r}=e,s=(0,S.getSettings)(),i=/a(?!\\)/i.test(s.formats.time.toLowerCase().replace(/\\\\/g,"").split("").reverse().join(""));return(0,t.createElement)(a.DateTimePicker,{currentDate:n,onChange:e=>h(e,r),is12Hour:i})},G=e=>{const{dateTimeEnd:n,setDateTimeEnd:r}=e,s=(0,S.getSettings)(),i=/a(?!\\)/i.test(s.formats.time.toLowerCase().replace(/\\\\/g,"").split("").reverse().join(""));return(0,t.createElement)(a.DateTimePicker,{currentDate:n,onChange:e=>E(e,r),is12Hour:i})},b=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];for(const[n,r]of Object.entries(e)){let e=n;t&&(e+=t);const a=new CustomEvent(e,{detail:r});dispatchEvent(a)}},C=e=>{const{dateTimeStart:r,setDateTimeStart:s}=e;return(0,t.useEffect)((()=>{T(),b({setDateTimeStart:r})})),(0,t.createElement)(a.PanelRow,null,(0,t.createElement)(a.Flex,null,(0,t.createElement)(a.FlexItem,null,(0,n.__)("Start","gatherpress")),(0,t.createElement)(a.FlexItem,null,(0,t.createElement)(a.Dropdown,{position:"bottom left",renderToggle:e=>{let{isOpen:n,onToggle:s}=e;return(0,t.createElement)(a.Button,{onClick:s,"aria-expanded":n,isLink:!0},(0,t.createElement)(D,{dateTimeStart:r}))},renderContent:()=>(0,t.createElement)(x,{dateTimeStart:r,setDateTimeStart:s})}))))},O=e=>{const{dateTimeEnd:r,setDateTimeEnd:s}=e;return(0,t.useEffect)((()=>{T(),b({setDateTimeEnd:r})})),(0,t.createElement)(a.PanelRow,null,(0,t.createElement)(a.Flex,null,(0,t.createElement)(a.FlexItem,null,(0,n.__)("End","gatherpress")),(0,t.createElement)(a.FlexItem,null,(0,t.createElement)(a.Dropdown,{position:"bottom left",renderToggle:e=>{let{isOpen:n,onToggle:s}=e;return(0,t.createElement)(a.Button,{onClick:s,"aria-expanded":n,isLink:!0},(0,t.createElement)(z,{dateTimeEnd:r}))},renderContent:()=>(0,t.createElement)(G,{dateTimeEnd:r,setDateTimeEnd:s})}))))};T(),(0,r.subscribe)((function(){const e=(0,r.select)("core/editor").isSavingPost(),t=(0,r.select)("core/editor").isAutosavingPost();P()&&e&&!t&&c()({path:"/gatherpress/v1/event/datetime/",method:"POST",data:{post_id:GatherPress.post_id,datetime_start:l().tz(GatherPress.event_datetime.datetime_start,g).format(p),datetime_end:l().tz(GatherPress.event_datetime.datetime_end,g).format(p),timezone:GatherPress.event_datetime.timezone,_wpnonce:GatherPress.nonce}}).then((()=>{}))}));const y=()=>{const[e,r]=(0,t.useState)(),[a,s]=(0,t.useState)();return(0,t.useEffect)((()=>{r(l().tz((()=>{let e=GatherPress.event_datetime.datetime_start;return e=""!==e?l().tz(e,g).format(u):v,GatherPress.event_datetime.datetime_start=e,e})(),g).format(u)),s(l().tz((()=>{let e=GatherPress.event_datetime.datetime_end;return e=""!==e?l().tz(e,g).format(u):l().tz(v,g).add(2,"hours").format(u),GatherPress.event_datetime.datetime_end=e,e})(),g).format(u))})),(0,t.createElement)("section",null,(0,t.createElement)("h3",null,(0,n.__)("Date & time","gatherpress")),(0,t.createElement)(C,{dateTimeStart:e,setDateTimeStart:r}),(0,t.createElement)(O,{dateTimeEnd:a,setDateTimeEnd:s}))},Y=()=>{const[e,s]=(0,t.useState)(""),i=(0,r.useDispatch)("core/editor").editPost,{unlockPostSaving:o}=(0,r.useDispatch)("core/editor"),l=(0,r.useSelect)((e=>e("core/editor").getEditedPostAttribute("_gp_venue"))),m=(0,r.useSelect)((e=>e("core").getEntityRecord("taxonomy","_gp_venue",l)))?.slug.replace("_venue_",""),c=l+":"+m;(0,t.useEffect)((()=>{var e;s(null!==(e=String(c))&&void 0!==e?e:""),b({setVenueId:m})}));let d=(0,r.useSelect)((e=>e("core").getEntityRecords("taxonomy","_gp_venue",{per_page:-1,context:"view"})),[e]);return d?(d=d.map((e=>({label:e.name,value:e.id+":"+e.slug.replace("_venue_","")}))),d.unshift({value:":",label:(0,n.__)("Choose a venue","gatherpress")})):d=[],(0,t.createElement)(a.PanelRow,null,(0,t.createElement)(a.Flex,null,(0,t.createElement)(a.FlexItem,null,(0,n.__)("Venue","gatherpress")),(0,t.createElement)(a.FlexItem,null,(0,t.createElement)(a.SelectControl,{label:(0,n.__)("Venue","gatherpress"),hideLabelFromVision:"true",value:e,onChange:e=>{(e=>{s(e);const t=""!==(e=e.split(":"))[0]?[e[0]]:[];i({_gp_venue:t}),b({setVenueId:e[1]}),o()})(e)},options:d,style:{width:"11rem"}}))))};(0,s.registerPlugin)("gp-event-settings",{render:()=>P()&&(0,t.createElement)(i.PluginDocumentSettingPanel,{name:"gp-event-settings",title:(0,n.__)("Event settings","gatherpress"),initialOpen:!0,className:"gp-event-settings"},(0,t.createElement)(a.__experimentalVStack,{spacing:2},(0,t.createElement)(y,null),(0,t.createElement)(a.__experimentalDivider,null),(0,t.createElement)(Y,null))),icon:""}),(0,r.dispatch)("core/edit-post").toggleEditorPanelOpened("gp-event-settings/gp-event-settings")})();